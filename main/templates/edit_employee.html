{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* MODIFICATION: 
          Added styles to make disabled fields look non-editable.
        */
        input:disabled, select:disabled, textarea:disabled {
            background-color: #f1f5f9; /* slate-100 */
            color: #64748b; /* slate-500 */
            cursor: not-allowed;
            border-color: #e2e8f0; /* slate-200 */
        }
        /* Style for the disabled 'x' delete button on files */
        input[type="checkbox"]:disabled + label {
            color: #cbd5e1; /* slate-300 */
            cursor: not-allowed;
            pointer-events: none;
        }
    </style>
    <link rel="icon" type="image/png" href="{% static 'images/logo.png' %}">
</head>
<body class="bg-slate-50 flex items-center justify-center min-h-screen py-12">
    <div class="bg-white rounded-xl shadow-lg p-8 m-4 w-full max-w-2xl">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-slate-800">Edit Employee Profile</h1>
            <p class="text-slate-500 mt-2">Update the details below for {{ employee.name }}.</p>
        </div>
        
        <!-- Django Messages Framework -->
        {% if messages %}
        <div class="mb-6 space-y-2">
            {% for message in messages %}
            <!-- FIX: Corrected 'class.' to 'class' -->
            <div class="p-4 rounded-lg {% if message.tags == 'success' %} bg-green-100 text-green-800 {% else %} bg-red-100 text-red-800 {% endif %}" role="alert">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <form method="post" enctype="multipart/form-data" action="{% url 'edit_employee' employee.id %}">
            {% csrf_token %} <!-- Django CSRF token for security -->
            <div class="space-y-6">
                
                <div>
                    <label for="name" class="block text-sm font-medium text-slate-700 mb-1">Full Name</label>
                    <input type="text" id="name" name="name" value="{{ employee.name }}" required 
                           class="block w-full px-4 py-2 text-slate-900 border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           {% if user.is_staff and not user.is_superuser %}disabled{% endif %}>
                           <!-- Rule: Disabled for STAFF, but editable for USER and SUPERUSER -->
                </div>

                <div>
                    <label for="age" class="block text-sm font-medium text-slate-700 mb-1">Age</label>
                    <input type="number" id="age" name="age" value="{{ employee.age }}" required 
                           class="block w-full px-4 py-2 text-slate-900 border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           {% if user.is_staff and not user.is_superuser %}disabled{% endif %}>
                           <!-- Rule: Disabled for STAFF -->
                </div>
                <div>
                    <label for="contact_number" class="block text-sm font-medium text-slate-700 mb-1">Contact Number</label>
                    <input type="text" id="contact_number" name="contact" value="{{ employee.contact_number }}" required 
                           class="block w-full px-4 py-2 text-slate-900 border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           pattern="\d{10}" title="Please enter a valid 10-digit contact number." maxlength="10"
                           {% if user.is_staff and not user.is_superuser %}disabled{% endif %}>
                           <!-- Rule: Disabled for STAFF -->
                </div>

                <div>
                    <label for="company" class="block text-sm font-medium text-slate-700 mb-1">Site</label>
                    <select id="company" name="company" required 
                            class="block w-full px-4 py-2 text-slate-900 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <!-- Rule: Editable by EVERYONE (User, Staff, Superuser) -->
                        <option value="BMM" {% if employee.company == 'BMM' %}selected{% endif %}>BMM</option>
                        <option value="SLR" {% if employee.company == 'SLR' %}selected{% endif %}>SLR</option>
                        <option value="ARJAS" {% if employee.company == 'ARJAS' %}selected{% endif %}>ARJAS</option>
                        <option value="JAIRAJ" {% if employee.company == 'JAIRAJ' %}selected{% endif %}>JAIRAJ</option>
                        <option value="MSSSL" {% if employee.company == 'MSSSL' %}selected{% endif %}>MSSSL</option>
                        <option value="AGNI" {% if employee.company == 'AGNI' %}selected{% endif %}>AGNI</option>
                        <option value="COEGA" {% if employee.company == 'COEGA' %}selected{% endif %}>COEGA</option>
                        <option value="CD TECH" {% if employee.company == 'CD TECH' %}selected{% endif %}>CD TECH</option>
                    </select>
                </div>
                
                <div>
                    <label for="role" class="block text-sm font-medium text-slate-700 mb-1">Designation</label>
                    <select id="role" name="role" required 
                            class="block w-full px-4 py-2 text-slate-900 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <!-- Rule: Editable by EVERYONE (User, Staff, Superuser) -->
                        <option value="">-- Select Role --</option>
                        <optgroup label="BRIGHT BAR DIVISION - OPERATORS">
                            <option value="PEELING OPERATOR" {% if employee.role == 'PEELING OPERATOR' %}selected{% endif %}>PEELING OPERATOR</option>
                            <option value="REELING OPERATOR" {% if employee.role == 'REELING OPERATOR' %}selected{% endif %}>REELING OPERATOR</option>
                            <option value="CENTERLESS GRINDER" {% if employee.role == 'CENTERLESS GRINDER' %}selected{% endif %}>CENTERLESS GRINDER</option>
                            <option value="BELT POLISH GRINDER" {% if employee.role == 'BELT POLISH GRINDER' %}selected{% endif %}>BELT POLISH GRINDER</option>
                            <option value="BAND SAW CUTTING OPERATOR" {% if employee.role == 'BAND SAW CUTTING OPERATOR' %}selected{% endif %}>BAND SAW CUTTING OPERATOR</option>
                            <option value="EOT CRANE OPERATOR (BRIGHT BAR)" {% if employee.role == 'EOT CRANE OPERATOR (BRIGHT BAR)' %}selected{% endif %}>EOT CRANE OPERATOR</option>
                        </optgroup>
                        <optgroup label="BRIGHT BAR DIVISION - MAINTENANCE">
                            <option value="SR MECHANICAL FITTER (BRIGHT BAR)" {% if employee.role == 'SR MECHANICAL FITTER (BRIGHT BAR)' %}selected{% endif %}>SR MECHANICAL FITTER</option>
                            <option value="MECHANICAL FITTER (BRIGHT BAR)" {% if employee.role == 'MECHANICAL FITTER (BRIGHT BAR)' %}selected{% endif %}>MECHANICAL FITTER</option>
                            <option value="SR ELECTRICAL TECHNICIAN (BRIGHT BAR)" {% if employee.role == 'SR ELECTRICAL TECHNICIAN (BRIGHT BAR)' %}selected{% endif %}>SR ELECTRICAL TECHNICIAN</option>
                            <option value="ELECTRICIAN (BRIGHT BAR)" {% if employee.role == 'ELECTRICIAN (BRIGHT BAR)' %}selected{% endif %}>ELECTRICIAN</option>
                            <option value="CRANE MAINTENANCE FITTER (BRIGHT BAR)" {% if employee.role == 'CRANE MAINTENANCE FITTER (BRIGHT BAR)' %}selected{% endif %}>CRANE MAINTENANCE FITTER</option>
                        </optgroup>
                        <optgroup label="BRIGHT BAR DIVISION - HEAT TREATMENT">
                            <option value="FURNACE OPERATOR (BRIGHT BAR)" {% if employee.role == 'FURNACE OPERATOR (BRIGHT BAR)' %}selected{% endif %}>FURNACE OPERATOR</option>
                        </optgroup>
                        <optgroup label="BRIGHT BAR DIVISION - PICKLING PLANT">
                            <option value="MAINTENANCE FITTER (PICKLING)" {% if employee.role == 'MAINTENANCE FITTER (PICKLING)' %}selected{% endif %}>MAINTENANCE FITTER</option>
                            <option value="UTILITY / PUMP OPERATOR (PICKLING)" {% if employee.role == 'UTILITY / PUMP OPERATOR (PICKLING)' %}selected{% endif %}>UTILITY / PUMP OPERATOR</option>
                        </optgroup>
                        <optgroup label="ROLLING MILL - TMT MILL OPERATION">
                            <option value="MILL FITTER (TMT)" {% if employee.role == 'MILL FITTER (TMT)' %}selected{% endif %}>MILL FITTER</option>
                            <option value="GAS CUTTER (TMT)" {% if employee.role == 'GAS CUTTER (TMT)' %}selected{% endif %}>GAS CUTTER</option>
                            <option value="ASSISTANT MILL FITTER (TMT)" {% if employee.role == 'ASSISTANT MILL FITTER (TMT)' %}selected{% endif %}>ASSISTANT MILL FITTER</option>
                            <option value="ROUGHING MILL FITTER (TMT)" {% if employee.role == 'ROUGHING MILL FITTER (TMT)' %}selected{% endif %}>ROUGHING MILL FITTER</option>
                            <option value="FINISHING MILL FITTER (TMT)" {% if employee.role == 'FINISHING MILL FITTER (TMT)' %}selected{% endif %}>FINISHING MILL FITTER</option>
                        </optgroup>
                        <optgroup label="ROLLING MILL - BAR MILL OPERATION">
                            <option value="MILL FITTER (BAR)" {% if employee.role == 'MILL FITTER (BAR)' %}selected{% endif %}>MILL FITTER</option>
                            <option value="GAS CUTTER (BAR)" {% if employee.role == 'GAS CUTTER (BAR)' %}selected{% endif %}>GAS CUTTER</option>
                            <option value="ASSISTANT MILL FITTER (BAR)" {% if employee.role == 'ASSISTANT MILL FITTER (BAR)' %}selected{% endif %}>ASSISTANT MILL FITTER</option>
                            <option value="ROUGHING MILL FITTER (BAR)" {% if employee.role == 'ROUGHING MILL FITTER (BAR)' %}selected{% endif %}>ROUGHING MILL FITTER</option>
                        </optgroup>
                        <optgroup label="ROLLING MILL - ROLL SHOP / GUIDE SHOP">
                            <option value="CNC OPERATOR"{% if employee.role == 'CNC OPERATOR' %}selected{% endif %}>CNC OPERATOR</option>
                            <option value="MACHINIST"{% if employee.role == 'MACHINIST' %}selected{% endif %}>MACHINIST</option>
                            <option value="ROLL ASSEMBLY FITTER" {% if employee.role == 'ROLL ASSEMBLY FITTER' %}selected{% endif %}>ROLL ASSEMBLY FITTER</option>
                            <option value="ABST ROLL ASSEMBLY FITTER" {% if employee.role == 'ABST ROLL ASSEMBLY FITTER' %}selected{% endif %}>ABST ROLL ASSEMBLY FITTER</option>
                            <option value="SR ROLL ASSEMBLY FITTER" {% if employee.role == 'SR ROLL ASSEMBLY FITTER' %}selected{% endif %}>SR ROLL ASSEMBLY FITTER</option>
                            <option value="SR GUIDE FITTER" {% if employee.role == 'SR GUIDE FITTER' %}selected{% endif %}>SR GUIDE FITTER</option>
                            <option value="GUIDE FITTER" {% if employee.role == 'GUIDE FITTER' %}selected{% endif %}>GUIDE FITTER</option>
                            <option value="STAND MAINTENANCE FITTER" {% if employee.role == 'STAND MAINTENANCE FITTER' %}selected{% endif %}>STAND MAINTENANCE FITTER</option>
                        </optgroup>
                        <optgroup label="ROLLING MILL - MECHANICAL">
                            <option value="FITTER (ROLLING MILL)" {% if employee.role == 'FITTER (ROLLING MILL)' %}selected{% endif %}>FITTER</option>
                            <option value="SR FITTER (ROLLING MILL)" {% if employee.role == 'SR FITTER (ROLLING MILL)' %}selected{% endif %}>SR FITTER</option>
                            <option value="ASSISTANT FITTER (ROLLING MILL)" {% if employee.role == 'ASSISTANT FITTER (ROLLING MILL)' %}selected{% endif %}>ASSISTANT FITTER</option>
                            <option value="WELDER (ROLLING MILL)" {% if employee.role == 'WELDER (ROLLING MILL)' %}selected{% endif %}>WELDER</option>
                            <option value="CRANE MAINTENANCE FITTER (ROLLING MILL)" {% if employee.role == 'CRANE MAINTENANCE FITTER (ROLLING MILL)' %}selected{% endif %}>CRANE MAINTENANCE FITTER</option>
                            <option value="HYDRAULIC FITTER (ROLLING MILL)" {% if employee.role == 'HYDRAULIC FITTER (ROLLING MILL)' %}selected{% endif %}>HYDRAULIC FITTER</option>
                            <option value="UTILITY FITTER (ROLLING MILL)" {% if employee.role == 'UTILITY FITTER (ROLLING MILL)' %}selected{% endif %}>UTILITY FITTER</option>
                            <option value="FABRICATION FITTER (ROLLING MILL)" {% if employee.role == 'FABRICATION FITTER (ROLLING MILL)' %}selected{% endif %}>FABRICATION FITTER</option>
                        </optgroup>
                        <optgroup label="ROLLING MILL - ELECTRICAL">
                            <option value="SR ELECTRICIAN (ROLLING MILL)" {% if employee.role == 'SR ELECTRICIAN (ROLLING MILL)' %}selected{% endif %}>SR ELECTRICIAN</option>
                            <option value="INSTRUMENT TECHNICIAN" {% if employee.role == 'INSTRUMENT TECHNICIAN' %}selected{% endif %}>INSTRUMENT TECHNICIAN</option>
                            <option value="ELECTRICAL TECHNICIAN (ROLLING MILL)" {% if employee.role == 'ELECTRICAL TECHNICIAN (ROLLING MILL)' %}selected{% endif %}>ELECTRICAL TECHNICIAN</option>
                            <option value="ELECTRICIAN (ROLLING MILL)" {% if employee.role == 'ELECTRICIAN (ROLLING MILL)' %}selected{% endif %}>ELECTRICIAN</option>
                            <option value="JR ELECTRICIAN (ROLLING MILL)" {% if employee.role == 'JR ELECTRICIAN (ROLLING MILL)' %}selected{% endif %}>JR ELECTRICIAN</option>
                        </optgroup>
                        <optgroup label="ROLLING MILL - OPERATOR">
                            <option value="UTILITY / PUMP OPERATOR (ROLLING MILL)" {% if employee.role == 'UTILITY / PUMP OPERATOR (ROLLING MILL)' %}selected{% endif %}>UTILITY / PUMP OPERATOR</option>
                            <option value="HYDRAULIC OPERATOR" {% if employee.role == 'HYDRAULIC OPERATOR' %}selected{% endif %}>HYDRAULIC OPERATOR</option>
                            <option value="MAIN PULPIT OPERATOR" {% if employee.role == 'MAIN PULPIT OPERATOR' %}selected{% endif %}>MAIN PULPIT OPERATOR</option>
                            <option value="BUNDLING DESK OPERATOR" {% if employee.role == 'BUNDLING DESK OPERATOR' %}selected{% endif %}>BUNDLING DESK OPERATOR</option>
                            <option value="LOCAL DESK OPERATOR" {% if employee.role == 'LOCAL DESK OPERATOR' %}selected{% endif %}>LOCAL DESK OPERATOR</option>
                            <option value="COLD SHEAR OPERATOR" {% if employee.role == 'COLD SHEAR OPERATOR' %}selected{% endif %}>COLD SHEAR OPERATOR</option>
                            <option value="FURNACE OPERATOR (ROLLING MILL)" {% if employee.role == 'FURNACE OPERATOR (ROLLING MILL)' %}selected{% endif %}>FURNACE OPERATOR</option>
                            <option value="PEEL BAR OPERATOR" {% if employee.role == 'PEEL BAR OPERATOR' %}selected{% endif %}>PEEL BAR OPERATOR</option>
                            <option value="EOT CRANE OPERATOR (ROLLING MILL)" {% if employee.role == 'EOT CRANE OPERATOR (ROLLING MILL)' %}selected{% endif %}>EOT CRANE OPERATOR</option>
                        </optgroup>
                        </optgroup label="STEEL MELTING DIVISION">
                            <option value="MOLD OPERATOR"{% if employee.role == 'MOLD OPERATOR' %}selected{% endif %}>MOLD OPERATOR</option>
                            <option value="LADLE OPERATOR"{% if employee.role == 'LADLE OPERATOR'%}selected{% endif %}>LADLE OPERATOR</option>
                            <option value="HOT LADLE CRANE OPERATOR" {% if employee.role == 'HOT LADLE CRANE OPERATOR'%}selected{% endif %}>HOT LADLE CRANE OPERATOR</option>
                            <option value="TUNDISH MAN"{% if employee.role == 'TUNDISH MAN'%}selected{% endif %}>TUNDISH MAN</option>
                            <option value="LRF/EOF TECHNICIAN"{% if employee.role == 'LRF/EOF TECHNICIAN'%}selected{% endif %}>LRF/EOF TECHNICIAN</option>
                            <option value="SR MAINTENANCE FITTER (SMD)"{% if employee.role ==  'SR MAINTENANCE FITTER (SMD)'%}selected{% endif %}>SR MAINTENANCE FITTER</option>
                            <option value="MAINTENANCE FITTER (SMD)"{% if employee.role ==  'MAINTENANCE FITTER (SMD)'%}selected{% endif %}>MAINTENANCE FITTER</option>
                            <option value="ELECTRICAL TECHNICIAN (SMD)"{% if employee.role ==  'ELECTRICAL TECHNICIAN (SMD)'%}selected{% endif %}>ELECTRICAL TECHNICIAN</option>
                            <option value="ELECTRICIAN (SMD)"{% if employee.role ==  'ELECTRICIAN (SMD)'%}selected{% endif %}>ELECTRICIAN</option>
                            <option value="TEAMER MAN"{% if employee.role ==  'TEAMER MAN'%}selected{% endif %}>TEAMER MAN</option>
                            <option value="CCM FITTER"{% if employee.role ==  'CCM FITTER'%}selected{% endif %}>CCM FITTER</option>
                            <option value="SBO OPERATOR"{% if employee.role ==  'SBO OPERATOR'%}selected{% endif %}>SBO OPERATOR</option>
                            <option value="MELTER"{% if employee.role ==  'MELTER'%}selected{% endif %}>MELTER</option>
                            <option value="FIRST HAND"{% if employee.role ==  'FIRST HAND'%}selected{% endif %}>FIRST HAND</option>
                            <option value="FURNACE INCHARAGE"{% if employee.role ==  'FURNACE INCHARAGE'%}selected{% endif %}>FURNACE INCHARGE</option>
                            <option value="SCRAP YARD SUPERVISOR"{% if employee.role ==  'SCRAP YARD SUPERVISOR'%}selected{% endif %}>SCRAP YARD SUPERVISOR</option>
                            <option value="CHARGING CRANE OPERATOR"{% if employee.role ==  'CHARGING CRANE OPERATOR'%}selected{% endif %}>CHARGING CRANE OPERATOR</option>
                            <option value="LAB TECHNICIAN"{% if employee.role ==  'LAB TECHNICIAN'%}selected{% endif %}>LAB TECHNICIAN</option>
                            <option value="TANDISH MESAN"{% if employee.role ==  'TANDISH MESAN'%}selected{% endif %}>TANDISH MESAN</option>
                            <option value="WELDER / GAS CUTTER (SMD)"{% if employee.role ==  'WELDER / GAS CUTTER (SMD)'%}selected{% endif %}>WELDER / GAS CUTTER</option>
                        </optgroup>
                    </select>
                </div>
                
                <div>
                    <label for="status" class="block text-sm font-medium text-slate-700 mb-1">Application Status</label>
                    <select id="status" name="status" required 
                            class="block w-full px-4 py-2 text-slate-900 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            {% if not user.is_staff %}disabled{% endif %}>
                            <!-- Rule: Disabled for regular USERS, editable for Staff and Superuser -->
                        <option value="pending" {% if employee.status == 'pending' %}selected{% endif %}>Pending</option>
                        <option value="selected" {% if employee.status == 'selected' %}selected{% endif %}>Selected</option>
                        <option value="rejected" {% if employee.status == 'rejected' %}selected{% endif %}>Rejected</option>
                        <option value="offered" {% if employee.status == 'offered' %}selected{% endif %}>Offered</option>
                        <option value="joined" {% if employee.status == 'joined' %}selected{% endif %}>Joined</option>
                        <option value ="left" {% if employee.status == 'left' %}selected{% endif %}>Left</option>
                    </select>
                </div>

                <!-- Remarks Field (Initially Hidden) -->
                <div id="remarks-container" class="hidden">
                    <label for="remarks" class="block text-sm font-medium text-slate-700 mb-1">
                        Remarks (Mandatory for Rejected)
                    </label>
                    <textarea id="remarks" name="remarks" rows="3" 
                              class="block w-full px-4 py-2 text-slate-900 border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                              {% if not user.is_staff %}disabled{% endif %}>{{ employee.remarks|default:'' }}</textarea>
                              <!-- Rule: Disabled for regular USERS -->
                </div>

                <!-- Offer Letter Field (Initially Hidden) -->
                <div id="offer-letter-container" class="hidden">
                    <label class="block text-sm font-medium text-slate-700 mb-1">Offer Letter</label>
                    {% if employee.offer_letter %}
                        <div id="offer-letter-file-container" class="flex items-center gap-2 text-sm text-slate-600 mb-3">
                            <span>Current file:</span>
                            <a href="{{ employee.offer_letter.url }}" id="offer-letter-link" class="text-blue-600 hover:underline font-medium" target="_blank">{{ employee.offer_letter.name }}</a>
                            <input type="checkbox" name="delete_offer_letter" id="delete_offer_letter" class="hidden peer"
                                   {% if not user.is_staff %}disabled{% endif %}>
                                   <!-- Rule: Disabled for regular USERS -->
                            <label for="delete_offer_letter" 
                                   class="cursor-pointer text-slate-400 hover:text-red-600 peer-checked:text-red-500" 
                                   title="Mark offer letter for deletion on update">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </label>
                        </div>
                    {% endif %}
                    <label for="offer_letter" class="text-sm text-slate-700">Upload New Offer Letter:</label>
                    <input type="file" name="offer_letter" id="offer_letter" 
                           class="mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                           {% if not user.is_staff %}disabled{% endif %}>
                           <!-- Rule: Disabled for regular USERS -->
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Resume</label>
                    {% if employee.resume %}
                        <div id="resume-container" class="flex items-center gap-2 text-sm text-slate-600 mb-3">
                            <span>Current file:</span>
                            <a href="{{ employee.resume.url }}" id="resume-link" class="text-blue-600 hover:underline font-medium" target="_blank">{{ employee.resume.name }}</a>
                            <input type="checkbox" name="delete_resume" id="delete_resume" class="hidden peer"
                                   {% if user.is_staff and not user.is_superuser %}disabled{% endif %}>
                                   <!-- Rule: Disabled for STAFF -->
                            <label for="delete_resume" 
                                   class="cursor-pointer text-slate-400 hover:text-red-600 peer-checked:text-red-500" 
                                   title="Mark resume for deletion on update">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </label>
                        </div>
                    {% endif %}
                    <label for="resume" class="text-sm text-slate-700">Upload New Resume:</label>
                    <input type="file" name="resume" id="resume" 
                           class="mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                           {% if user.is_staff and not user.is_superuser %}disabled{% endif %}>
                           <!-- Rule: Disabled for STAFF -->
                </div>
            </div>
            
            <div class="flex items-center justify-end mt-8 pt-6 border-t border-slate-200">
                <a href= "{% url 'employee_list' %}" class="text-sm font-medium text-slate-600 hover:text-slate-800 mr-6">Cancel</a>
                <button type="submit" class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-semibold rounded-md text-white bg-slate-800 hover:bg-slate-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-700">
                    Update Profile
                </button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Resume Delete Logic ---
            const deleteCheckbox = document.getElementById('delete_resume');
            const resumeLink = document.getElementById('resume-link');
            if (deleteCheckbox && resumeLink) {
                deleteCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        resumeLink.classList.add('line-through', 'text-slate-400', 'pointer-events-none');
                    } else {
                        resumeLink.classList.remove('line-through', 'text-slate-400', 'pointer-events-none');
                    }
                });
            }

            // --- Offer Letter Delete Logic ---
            const deleteOfferCheckbox = document.getElementById('delete_offer_letter');
            const offerLink = document.getElementById('offer-letter-link');
            if (deleteOfferCheckbox && offerLink) {
                deleteOfferCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        offerLink.classList.add('line-through', 'text-slate-400', 'pointer-events-none');
                    } else {
                        offerLink.classList.remove('line-through', 'text-slate-400', 'pointer-events-none');
                    }
                });
            }

            // --- Conditional Field Logic ---
            const statusSelect = document.getElementById('status');
            const remarksContainer = document.getElementById('remarks-container');
            const remarksTextarea = document.getElementById('remarks'); // Get the textarea itself
            const offerContainer = document.getElementById('offer-letter-container');

            function toggleFieldsBasedOnStatus() {
                const selectedStatus = statusSelect.value;

                // --- MODIFICATION: Handle Remarks Field ---
                if (selectedStatus === 'rejected') {
                    remarksContainer.classList.remove('hidden');
                    remarksTextarea.required = true; // Set as mandatory
                } else {
                    remarksContainer.classList.add('hidden');
                    remarksTextarea.required = false; // Set as NOT mandatory
                }

                // --- Handle Offer Letter Field ---
                if (selectedStatus === 'offered') {
                    offerContainer.classList.remove('hidden');
                } else {
                    offerContainer.classList.add('hidden');
                }
            }

            // Add event listener to run the function on change
            statusSelect.addEventListener('change', toggleFieldsBasedOnStatus);
            
            // Run the function once on page load to set the correct initial state
            toggleFieldsBasedOnStatus();
        });
    </script>
</body>
</html>

